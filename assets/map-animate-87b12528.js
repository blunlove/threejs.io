import{R as Z,F as K,h as ee,r as te,a as ae,f as D,g as ie,c as ne,o as se,s as re,b as oe,p as le,d as ce,e as pe,G as b,V as g,i as H,M as y,t as F,j as _,O as Q,S as Y,E as de,k as w,l as he,m as ue,L as I,n as fe,q as me,B as ge,u as ve,v as ye,w as be,C as T,x as we,y as xe,z as Le,A as m,D as Me,H as Pe,P as Ge,I as A,J as R,K as q,N as O,Q as L,T as Se,U as C,W as B,X as M,Y as Ce,Z as Te,_ as Oe,$ as z,a0 as k,a1 as Be,a2 as Ie,a3 as N,a4 as _e,a5 as $,a6 as V,a7 as ze,a8 as je}from"./index-1fa41ed1.js";import{r as Ee,a as Fe,u as De,b as Ae,o as Re,c as qe,d as U,e as X,f as S,F as ke,g as Ne,n as $e,t as Ve}from"./index-265faec9.js";class Ue{constructor(t=null,e="浙江省"){this.onLoadCallback=t,this.province=e,this.init()}init(){this.instance=new Z,this.instance.addLoader(K,"FileLoader"),this.instance.on("onProgress",(i,a,n)=>{(a/n*100).toFixed(2)+""}),this.instance.on("onLoad",()=>{this.onLoadCallback&&this.onLoadCallback()});let t="./",e=[{type:"Texture",name:"huiguang",path:ee},{type:"Texture",name:"rotationBorder1",path:te},{type:"Texture",name:"rotationBorder2",path:ae},{type:"Texture",name:"guangquan1",path:D},{type:"Texture",name:"guangquan2",path:ie},{type:"Texture",name:"chinaBlurLine",path:ne},{type:"Texture",name:"ocean",path:se},{type:"Texture",name:"side",path:re},{type:"Texture",name:"flyLine",path:oe},{type:"Texture",name:"flyLineFocus",path:D},{type:"Texture",name:"pathLine",path:le},{type:"Texture",name:"arrow",path:ce},{type:"Texture",name:"point",path:pe},{type:"File",name:"province",path:`${t}assets/json/${this.province}/index.json`},{type:"File",name:"china",path:t+"assets/json/中华人民共和国.json"}];this.instance.loadAll(e)}}class Xe{constructor({assets:t,time:e},i={}){this.mapGroup=new b,this.assets=t,this.time=e,this.coordinates=[],this.config=Object.assign({position:new g(0,0,0),center:new H(0,0),data:"",renderOrder:1,topFaceMaterial:new y({color:1582651,transparent:!0,opacity:1}),sideMaterial:new y({color:464171,transparent:!0,opacity:1}),depth:.1},i),this.mapGroup.position.copy(this.config.position);let a=F(this.config.data);this.create(a)}geoProjection(t){return _().center(this.config.center).scale(120).translate([0,0])(t)}create(t){t.features.forEach(e=>{const i=new Q;let{name:a,center:n=[],centroid:s=[]}=e.properties;this.coordinates.push({name:a,center:n,centroid:s});const l={depth:this.config.depth,bevelEnabled:!0,bevelSegments:1,bevelThickness:.1};let r=[this.config.topFaceMaterial,this.config.sideMaterial];e.geometry.coordinates.forEach(o=>{o.forEach((d,c)=>{const p=new Y;for(let f=0;f<d.length;f++){if(!d[f][0]||!d[f][1])return!1;const[v,x]=this.geoProjection(d[f]);f===0&&p.moveTo(v,-x),p.lineTo(v,-x)}const u=new de(p,l),h=new w(u,r);i.add(h)})}),this.mapGroup.add(i)})}getCoordinates(){return this.coordinates}setParent(t){t.add(this.mapGroup)}}class W{constructor({},t={}){this.mapGroup=new b,this.coordinates=[],this.config=Object.assign({position:new g(0,0,0),center:new H(0,0),data:"",renderOrder:1,merge:!1,material:new y({color:1582651,transparent:!0,opacity:1})},t),this.mapGroup.position.copy(this.config.position);let e=F(this.config.data);this.create(e)}geoProjection(t){return _().center(this.config.center).scale(120).translate([0,0])(t)}create(t){let{merge:e}=this.config,i=[];if(t.features.forEach(a=>{const n=new Q;let{name:s,adcode:l,center:r=[],centroid:o=[]}=a.properties;this.coordinates.push({name:s,adcode:l,center:r,centroid:o}),n.userData.name=s,a.geometry.coordinates.forEach(d=>{d.forEach(c=>{const p=new Y;for(let h=0;h<c.length;h++){if(!c[h][0]||!c[h][1])return!1;const[f,v]=this.geoProjection(c[h]);h===0&&p.moveTo(f,-v),p.lineTo(f,-v)}const u=new he(p);if(e)i.push(u);else{const h=new w(u,this.config.material);h.renderOrder=this.config.renderOrder,h.userData.name=s,h.userData.adcode=l,n.add(h)}})}),e||this.mapGroup.add(n)}),e){let a=ue(i);const n=new w(a,this.config.material);n.renderOrder=this.config.renderOrder,this.mapGroup.add(n)}}getCoordinates(){return this.coordinates}setParent(t){t.add(this.mapGroup)}}class j{constructor({},t={}){this.config=Object.assign({visibelProvince:"",center:[0,0],data:"",material:new I({color:16777215}),type:"LineLoop",renderOrder:1},t);let e=F(this.config.data),i=this.create(e);this.lineGroup=i}geoProjection(t){return _().center(this.config.center).scale(120).translate([0,0])(t)}create(t){const{type:e,visibelProvince:i}=this.config;let a=t.features,n=new b;for(let s=0;s<a.length;s++){const l=a[s];l.properties.name!==i&&l.geometry.coordinates.forEach(r=>{const o=[];let d=null;e==="Line2"?(r[0].forEach(c=>{const[p,u]=this.geoProjection(c);o.push(p,-u,0)}),d=this.createLine2(o)):r[0].forEach(c=>{const[p,u]=this.geoProjection(c);o.push(new g(p,-u,0)),d=this.createLine(o)}),n.add(d)})}return n}createLine2(t){const{material:e,renderOrder:i}=this.config,a=new fe;a.setPositions(t);let n=new me(a,e);return n.name="mapLine2",n.renderOrder=i,n.computeLineDistances(),n}createLine(t){const{material:e,renderOrder:i,type:a}=this.config,n=new ge;n.setFromPoints(t);let s=new ve(n,e);return s.renderOrder=i,s.name="mapLine",s}setParent(t){t.add(this.lineGroup)}}const We=[{value:166,lng:119.00838863314104,lat:29.70446787438727},{value:196,lng:121.95888480416225,lat:29.804570962222094},{value:145,lng:121.1763690119717,lat:29.943827249850777},{value:101,lng:121.56920938135673,lat:29.85263574108389},{value:199,lng:120.9772766279951,lat:28.330342193214033},{value:167,lng:120.33101898043361,lat:30.565600410098323},{value:169,lng:120.36095289685078,lat:30.739761809104824},{value:101,lng:119.983185482632,lat:31.03706617454779},{value:121,lng:121.20282810334723,lat:29.45300711212515},{value:132,lng:120.04632515461387,lat:29.535586166289217},{value:132,lng:119.88396764642604,lat:29.24289373808931},{value:119,lng:118.20295164180662,lat:28.97847155167772},{value:138,lng:119.30239039019484,lat:28.963362607831762},{value:183,lng:122.11925213943688,lat:30.09279983271788},{value:103,lng:122.0641872449813,lat:30.624331727210976},{value:110,lng:121.24428726916929,lat:28.29819603626963},{value:171,lng:120.83475957600818,lat:29.104535097251688},{value:174,lng:119.70182146944745,lat:28.267110085326326}],He=[{name:"监测点#01",level:"差",value:84.9,lng:118.27595005,lat:29.11596322},{name:"监测点#02",level:"极好",value:12.5,lng:118.94093792,lat:27.90619049},{name:"监测点#03",level:"良好",value:52.8,lng:121.35456753,lat:28.34783376},{name:"监测点#04",level:"好",value:32,lng:122.10985921,lat:30.05331943}];function E(P){return P.sort((t,e)=>e.value-t.value),P}class Qe extends ye{constructor(t,{province:e}){super(t),this.depth=.5,this.clicked=!1,this.scene.fog=new be(1058614,1,50),this.scene.background=new T(1058614),this.camera.instance.position.set(-13.767695123014105,12.990152163077308,39.28228164159694),this.camera.instance.near=1,this.camera.instance.far=1e4,this.camera.instance.updateProjectionMatrix(),this.interactionManager=new we(this.renderer.instance,this.camera.instance,this.canvas),this.province=e,this.playing=!1,this.initEnvironment(),this.assets=new Ue(()=>{var a,n;this.provincesData=JSON.parse((a=this.assets.instance.assets.find(s=>s.name==="province"))==null?void 0:a.data).features.map(s=>({name:s.properties.name,enName:xe(s.properties.name,{toneType:"none"}).replace(/\s*/g,""),value:98,center:s.properties.center||s.properties.centroid,centroid:s.properties.centroid||s.properties.center})),this.chinaData=JSON.parse((n=this.assets.instance.assets.find(s=>s.name==="china"))==null?void 0:n.data).features.filter(s=>s.properties.name).map(s=>({name:s.properties.name,center:s.properties.center||s.properties.centroid,centroid:s.properties.centroid||s.properties.center})),this.pointCenter=this.provincesData[0].centroid,this.flyLineCenter=this.provincesData[0].centroid,this.labelGroup=new b,this.label3d=new Le(this),this.labelGroup.rotateX(-Math.PI/2),this.eventElement=[],this.defaultMaterial=null,this.defaultLightMaterial=null,this.scene.add(this.labelGroup),this.createFloor(),this.createChinaBlurLine(),this.createGrid(),this.createRotateBorder(),this.createLabel(),this.createMap(),this.createAnimateVideo(),this.createEvent(),setTimeout(()=>{this.createFlyLine(!0)},5e3),this.createParticles();let i=m.timeline();i.addLabel("focusMap",2),i.addLabel("focusMapOpacity",2.5),i.addLabel("bar",3.5),i.add(m.to(this.camera.instance.position,{duration:2.5,x:-.2515849818960619,y:12.397744557047988,z:14.647659671139275,ease:"circ.out"})),i.add(m.to(this.focusMapGroup.position,{duration:1,x:0,y:0,z:0}),"focusMap"),i.add(m.to(this.focusMapGroup.scale,{duration:1,x:1,y:1,z:1,ease:"circ.out"}),"focusMap"),i.add(m.to(this.focusMapTopMaterial,{duration:1,opacity:1,ease:"circ.out"}),"focusMapOpacity"),i.add(m.to(this.focusMapSideMaterial,{duration:1,opacity:1,ease:"circ.out",onComplete:()=>{this.focusMapSideMaterial.transparent=!1}}),"focusMapOpacity"),i.add(m.to(this.zhejiangLineMaterial,{duration:.5,delay:.3,opacity:1}),"focusMapOpacity"),i.add(m.to(this.rotateBorder1.scale,{delay:.3,duration:1,x:1,y:1,z:1,ease:"circ.out"}),"focusMapOpacity"),i.add(m.to(this.rotateBorder2.scale,{duration:1,delay:.5,x:1,y:1,z:1,ease:"circ.out"}),"focusMapOpacity"),this.addOtherLabel(i),this.addBar(i),this.addAllCityLabel(i)},this.province)}initEnvironment(){let t=new Me(16777215,5);this.scene.add(t);let e=new Pe(16777215,5);e.position.set(-30,6,-8),e.castShadow=!0,e.shadow.radius=20,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,this.scene.add(e),this.createPointLight({color:"#1d5e5e",intensity:600,distance:1e4,x:-9,y:3,z:-3}),this.createPointLight({color:"#1d5e5e",intensity:100,distance:1e4,x:0,y:2,z:5})}createPointLight(t){const e=new Ge(1924702,t.intensity,t.distance);e.position.set(t.x,t.y,t.z),this.scene.add(e)}addOtherLabel(t){this.otherLabel.map((e,i)=>{let a=e.element.querySelector(".other-label");t.add(m.to(a,{duration:1,delay:.1*i,translateY:0,opacity:1,ease:"circ.out"}),"focusMapOpacity")})}addBar(t){this.allBar.map((e,i)=>{t.add(m.to(e.scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"}),"bar")}),this.allBarMaterial.map((e,i)=>{t.add(m.to(e,{duration:1,delay:.1*i,opacity:1,ease:"circ.out"}),"bar")})}addAllCityLabel(t){this.allCityLabel.map((e,i)=>{let a=e.element.querySelector(".provinces-label-wrap"),n=e.element.querySelector(".number .value"),s=Number(n.innerText),l={score:0};t.add(m.to(a,{duration:1,delay:.2*i,translateY:0,opacity:1,ease:"circ.out"}),"bar");let r=m.to(l,{duration:1,delay:.2*i,score:s,onUpdate:o});function o(){n.innerText=l.score.toFixed(0)}t.add(r,"bar")}),this.allGuangquan.map((e,i)=>{t.add(m.to(e.children[0].scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"}),"bar"),t.add(m.to(e.children[1].scale,{duration:1,delay:.1*i,x:1,y:1,z:1,ease:"circ.out"}),"bar")})}createMap(){let t=new b,e=new b;this.focusMapGroup=e;let{china:i,chinaTopLine:a}=this.createChina(),{zhejiang:n,zhejiangTop:s,guangdonLine:l}=this.createProvince();i.setParent(t),a.setParent(t),n.setParent(e),s.setParent(e),l.setParent(e),e.position.set(0,0,-.01),e.scale.set(1,1,0),t.add(e),t.rotateX(-Math.PI/2),t.position.set(0,.2,0),this.scene.add(t),this.createBar()}createChina(){let t=this.assets.instance.getResource("china"),e=new W(this,{data:t,center:this.pointCenter,merge:!1,material:new A({color:1387591,transparent:!0,opacity:1}),renderOrder:2}),i=new j(this,{center:this.pointCenter,visibelProvince:this.province,data:t,material:new I({color:4162253}),renderOrder:3});i.lineGroup.position.z+=.01;let a=new j(this,{center:this.pointCenter,data:t,material:new I({color:4162253,transparent:!0,opacity:.4}),renderOrder:3});return a.lineGroup.position.z-=.59,{china:e,chinaTopLine:i,chinaBottomLine:a}}createProvince(){let t=this.assets.instance.getResource("province"),[e,i]=this.createProvinceMaterial();this.focusMapTopMaterial=e,this.focusMapSideMaterial=i;let a=new Xe(this,{center:this.pointCenter,position:new g(0,0,.11),data:t,depth:.5,topFaceMaterial:e,sideMaterial:i,renderOrder:9}),n=new R({color:16777215,transparent:!0,opacity:.5});new q(n,{uColor1:2780818,uColor2:1058614}),this.defaultMaterial=n,this.defaultLightMaterial=this.defaultMaterial.clone(),this.defaultLightMaterial.emissive.setHex(725293),this.defaultLightMaterial.emissiveIntensity=3.5;let s=new W(this,{center:this.pointCenter,position:new g(0,0,.72),data:t,material:n,renderOrder:2});s.mapGroup.children.map(r=>{r.children.map(o=>{o.type==="Mesh"&&this.eventElement.push(o)})}),this.zhejiangLineMaterial=new I({color:16777215,opacity:0,transparent:!0,fog:!1});let l=new j(this,{center:this.pointCenter,data:t,material:this.zhejiangLineMaterial,renderOrder:3});return l.lineGroup.position.z+=.73,{zhejiang:a,zhejiangTop:s,guangdonLine:l}}createProvinceMaterial(){let t=new A({color:16777215,transparent:!0,opacity:0,fog:!1,side:O});t.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new T(2780818)},uColor2:{value:new T(1058614)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        void main() {
          vAlpha = alpha;
          vPosition = position;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
      
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
      
      // https://github.com/mrdoob/three.js/pull/22425
      #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.x/15.78); // 15.78
      
      outgoingLight = outgoingLight*gradient;
     
      if(vPosition.z>0.3){
        diffuseColor.a *= 0.5;
      }
      
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)};let e=this.assets.instance.getResource("side");e.wrapS=L,e.wrapT=L,e.repeat.set(1,1.5),e.offset.y+=.065;let i=new R({color:16777215,map:e,fog:!1,side:O});return this.time.on("tick",()=>{e.offset.y+=.005}),i.onBeforeCompile=a=>{a.uniforms={...a.uniforms,uColor1:{value:new T(2780818)},uColor2:{value:new T(2780818)}},a.vertexShader=a.vertexShader.replace("void main() {",`
        attribute float alpha;
        varying vec3 vPosition;
        varying float vAlpha;
        void main() {
          vAlpha = alpha;
          vPosition = position;
      `),a.fragmentShader=a.fragmentShader.replace("void main() {",`
        varying vec3 vPosition;
        varying float vAlpha;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
      
        void main() {
      `),a.fragmentShader=a.fragmentShader.replace("#include <opaque_fragment>",`
      #ifdef OPAQUE
      diffuseColor.a = 1.0;
      #endif
      
      // https://github.com/mrdoob/three.js/pull/22425
      #ifdef USE_TRANSMISSION
      diffuseColor.a *= transmissionAlpha + 0.1;
      #endif
      vec3 gradient = mix(uColor1, uColor2, vPosition.z/1.2);
      
      outgoingLight = outgoingLight*gradient;
      
      
      gl_FragColor = vec4( outgoingLight, diffuseColor.a  );
      `)},[t,i]}createBar(){let t=this,e=E(this.provincesData);const i=new b,a=.7,n=4*a,s=e[0].value;this.allBar=[],this.allBarMaterial=[],this.allGuangquan=[],this.allCityLabel=[],e.map((r,o)=>{let d=n*(r.value/s),c=new y({color:16777215,transparent:!0,opacity:0,depthTest:!1,fog:!1});new q(c,{uColor1:o>3?16506760:5291006,uColor2:o>3?16776948:7863285,size:d,dir:"y"});const p=new Se(.1*a,.1*a,d);p.translate(0,0,d/2);const u=new w(p,c);u.renderOrder=5;let h=u,[f,v]=this.geoProjection(r.centroid);h.position.set(f,-v,.95),h.scale.set(1,1,0);let x=this.createQuan(new g(f,.94,v),o),G=this.createHUIGUANG(d,o>3?16776948:7863285);h.add(...G),i.add(h),i.rotation.x=-Math.PI/2;let J=l(r,o,new g(f,-v,1.6+d));this.allBar.push(h),this.allBarMaterial.push(c),this.allGuangquan.push(x),this.allCityLabel.push(J)}),this.scene.add(i);function l(r,o,d){let c=t.label3d.create("","provinces-label",!1);return c.init(`<div class='provinces-label ${o>4?"yellow":""}'>
      <div class='provinces-label-wrap'>
        <div class='number'><span class='value'>${r.value}</span><span class='unit'>万人</span></div>
        <div class='name'>
          <span class='zh'>${r.name}</span>
          <span class='en'>${r.enName.toUpperCase()}</span>
        </div>
        <div class='no'>${o+1}</div>
      </div>
    </div>`,d),t.label3d.setLabelStyle(c,.01,"x"),c.setParent(t.labelGroup),c}}createEvent(){let t=[];const e=a=>{a.traverse(n=>{n.isMesh&&(n.material=this.defaultMaterial)})},i=a=>{a.traverse(n=>{n.isMesh&&(n.material=this.defaultLightMaterial)})};this.eventElement.map(a=>{this.interactionManager.add(a),a.addEventListener("mousedown",n=>{Ee.push({path:"city",query:{province:this.province,name:n.target.userData.name}})}),a.addEventListener("mouseover",n=>{t.includes(n.target.parent)||t.push(n.target.parent),document.body.style.cursor="pointer",i(n.target.parent)}),a.addEventListener("mouseout",n=>{t=t.filter(s=>s.userData.name!==n.target.parent.userData.name),t.length>0&&t[t.length-1],e(n.target.parent),document.body.style.cursor="default"})})}createHUIGUANG(t,e){let i=new C(.35,t);i.translate(0,t/2,0);const a=this.assets.instance.getResource("huiguang");a.colorSpace=B,a.wrapS=L,a.wrapT=L;let n=new y({color:e,map:a,transparent:!0,opacity:.4,depthWrite:!1,side:O,blending:M}),s=new w(i,n);s.renderOrder=10,s.rotateX(Math.PI/2);let l=s.clone(),r=s.clone();return l.rotateY(Math.PI/180*60),r.rotateY(Math.PI/180*120),[s,l,r]}createQuan(t,e){const i=this.assets.instance.getResource("guangquan1"),a=this.assets.instance.getResource("guangquan2");let n=new C(.5,.5),s=new y({color:16777215,map:i,alphaMap:i,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:M}),l=new y({color:16777215,map:a,alphaMap:a,opacity:1,transparent:!0,depthTest:!1,fog:!1,blending:M}),r=new w(n,s),o=new w(n,l);return r.renderOrder=6,o.renderOrder=6,r.rotateX(-Math.PI/2),o.rotateX(-Math.PI/2),r.position.copy(t),o.position.copy(t),o.position.y-=.001,r.scale.set(0,0,0),o.scale.set(0,0,0),this.quanGroup=new b,this.quanGroup.add(r,o),this.scene.add(this.quanGroup),this.time.on("tick",()=>{r.rotation.z+=.05}),this.quanGroup}createGrid(){new Ce(this,{gridSize:50,gridDivision:20,gridColor:1788784,shapeSize:.5,shapeColor:2776970,pointSize:.1,pointColor:1396093,diffuse:!0,diffuseSpeed:10,diffuseColor:3050457})}createFloor(){let t=new C(20,20);const e=this.assets.instance.getResource("ocean");e.colorSpace=B,e.wrapS=L,e.wrapT=L,e.repeat.set(1,1);let i=new y({map:e,opacity:1}),a=new w(t,i);a.rotateX(-Math.PI/2),a.position.set(0,-.7,0),this.scene.add(a)}createChinaBlurLine(){let t=new C(147,147);const e=this.assets.instance.getResource("chinaBlurLine");e.colorSpace=B,e.wrapS=L,e.wrapT=L,e.generateMipmaps=!1,e.minFilter=Te,e.repeat.set(1,1);let i=new y({color:4162253,alphaMap:e,transparent:!0,opacity:.5}),a=new w(t,i);a.rotateX(-Math.PI/2),a.position.set(-33.2,-.5,-5.2),this.scene.add(a)}createAnimateVideo(){this.createAnimateVideoItem(".map-zj-video1",new g(-9,.4,-2))}createAnimateVideoItem(t,e){let i=document.querySelector(t);window.addEventListener("pointerdown",()=>{this.playing||(i.play(),this.playing=!0)});let a=new Oe(i);a.colorSpace=B;let n=1.2,s=new C(2.5*n,1*n),l=new y({color:10807286,alphaMap:a,transparent:!0,opacity:1,blending:M}),r=new w(s,l);r.rotateX(-Math.PI/2),r.position.copy(e),r.renderOrder=10,this.scene.add(r)}createLabel(){let t=this,e=this.labelGroup,i=this.label3d,a=this.chinaData.filter(o=>o.name!==this.province).map(o=>s(o,i,e)),n=l({name:this.province,enName:"ZHEJIANG PROVINCE",center:[this.pointCenter[0],this.pointCenter[1]-3]},i,e);r({icon:z,center:[125.109913,26.881466],width:"40px",height:"40px",reflect:!0},i,e),r({icon:z,center:[116.109913,26.881466],width:"20px",height:"20px",reflect:!1},i,e),a.push(n),this.otherLabel=a;function s(o,d,c){let p=d.create("","china-label",!1);const[u,h]=t.geoProjection(o.center);return p.init(`<div class='other-label'><img class='label-icon' src='${z}'>${o.name}</div>`,new g(u,-h,.4)),d.setLabelStyle(p,.02,"x"),p.setParent(c),p}function l(o,d,c){let p=d.create("","guangdong-label",!1);const[u,h]=t.geoProjection(o.center);return p.init(`<div class='other-label'><span>${o.name}</span><span>${o.enName}</span></div>`,new g(u,-h,.4)),d.setLabelStyle(p,.02,"x"),p.setParent(c),p}function r(o,d,c){let p=d.create("",`decoration-label  ${o.reflect?" reflect":""}`,!1);const[u,h]=t.geoProjection(o.center);return p.init(`<div class='other-label'><img class='label-icon' style='width:${o.width};height:${o.height}' src='${o.icon}'>`,new g(u,-h,.4)),d.setLabelStyle(p,.02,"x"),p.setParent(c),p}}createRotateBorder(){let t=12,e=this.assets.instance.getResource("rotationBorder1"),i=this.assets.instance.getResource("rotationBorder2"),a=new k(this,{width:t*1.178,needRotate:!0,rotateSpeed:.001,material:new y({map:e,color:4763647,transparent:!0,opacity:.2,side:O,depthWrite:!1,blending:M}),position:new g(0,.28,0)});a.instance.renderOrder=6,a.instance.scale.set(0,0,0),a.setParent(this.scene);let n=new k(this,{width:t*1.116,needRotate:!0,rotateSpeed:-.004,material:new y({map:i,color:4763647,transparent:!0,opacity:.4,side:O,depthWrite:!1,blending:M}),position:new g(0,.3,0)});n.instance.renderOrder=6,n.instance.scale.set(0,0,0),n.setParent(this.scene),this.rotateBorder1=a.instance,this.rotateBorder2=n.instance}createFlyLine(t=!1){this.flyLineGroup=new b,this.flyLineGroup.visible=t,this.scene.add(this.flyLineGroup);const e=this.assets.instance.getResource("flyLine");e.colorSpace=B,e.wrapS=L,e.wrapT=L,e.repeat.set(1,1);const i=.03,a=32,n=8,s=!1;let[l,r]=this.geoProjection(this.flyLineCenter),o=new g(l,-r,0);const d=new y({map:e,alphaMap:e,color:2781042,transparent:!0,fog:!1,opacity:1,depthTest:!1,blending:M});this.time.on("tick",()=>{e.offset.x-=.006}),this.provincesData.map(c=>{let[p,u]=this.geoProjection(c.centroid),h=new g(p,-u,0);const f=new g;f.addVectors(o,h).multiplyScalar(.5),f.setZ(3);const v=new Be(o,f,h),x=new Ie(v,a,i,n,s),G=new w(x,d);G.rotation.x=-Math.PI/2,G.position.set(0,.94,0),G.renderOrder=21,this.flyLineGroup.add(G)}),this.createFlyLineFocus(!0)}createFlyLineFocus(t=!1){this.flyLineFocusGroup=new b,this.flyLineFocusGroup.visible=t,this.flyLineFocusGroup.rotation.x=-Math.PI/2;let[e,i]=this.geoProjection([119.476498,29.898918]);this.flyLineFocusGroup.position.set(e,.942,i),this.scene.add(this.flyLineFocusGroup);const a=this.assets.instance.getResource("flyLineFocus"),n=new C(1,1),s=new y({color:16777215,map:a,alphaMap:a,transparent:!0,fog:!1,depthTest:!1,blending:M}),l=new w(n,s);l.scale.set(0,0,0);const r=l.clone();r.material=s.clone(),this.flyLineFocusGroup.add(l,r),m.to(l.material,{opacity:0,repeat:-1,yoyo:!1,duration:1}),m.to(l.scale,{x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1}),m.to(r.material,{delay:.5,opacity:0,repeat:-1,yoyo:!1,duration:1}),m.to(r.scale,{delay:.5,x:1.5,y:1.5,z:1.5,repeat:-1,yoyo:!1,duration:1})}createParticles(){this.particles=new N(this,{num:10,range:30,dir:"up",speed:.05,material:new _e({map:N.createTexture(),size:1,color:61166,transparent:!0,opacity:1,depthTest:!1,depthWrite:!1,vertexColors:!0,blending:M,sizeAttenuation:!0})}),this.particles.instance.position.set(0,0,0),this.particles.instance.rotation.x=-Math.PI/2,this.particles.setParent(this.scene),this.particles.enable=!1,this.particles.instance.visible=!1}createScatter(){this.scatterGroup=new b,this.scatterGroup.visible=!1,this.scatterGroup.rotation.x=-Math.PI/2,this.scene.add(this.scatterGroup);const t=this.assets.instance.getResource("arrow"),e=new $({map:t,color:16776948,fog:!1,transparent:!0,depthTest:!1});let i=E(We),a=i[0].value;i.map(n=>{const s=new V(e);s.renderOrder=23;let l=.1+n.value/a*.2;s.scale.set(l,l,l);let[r,o]=this.geoProjection([n.lng,n.lat]);s.position.set(r,-o,this.depth+.45),s.userData.position=[r,-o,this.depth+.45],this.scatterGroup.add(s)})}createInfoPoint(){let t=this;this.InfoPointGroup=new b,this.InfoPointGroup.visible=!1,this.InfoPointGroup.rotation.x=-Math.PI/2,this.scene.add(this.InfoPointGroup),this.infoPointIndex=0,this.infoPointLabelTime=null,this.infoLabelElement=[];let e=this.label3d;const i=this.assets.instance.getResource("point");let a=[16776948,7863285],n=E(He),s=n[0].value;n.map((r,o)=>{const d=new $({map:i,color:a[o%a.length],fog:!1,transparent:!0,depthTest:!1}),c=new V(d);c.renderOrder=23;let p=.7+r.value/s*.4;c.scale.set(p,p,p);let[u,h]=this.geoProjection([r.lng,r.lat]),f=[u,-h,this.depth+.7];c.position.set(...f),c.userData.position=[...f],c.userData={position:[u,-h,this.depth+.7],name:r.name,value:r.value,level:r.level,index:o},this.InfoPointGroup.add(c);let v=l(r,e,this.InfoPointGroup);this.infoLabelElement.push(v),this.interactionManager.add(c),c.addEventListener("mousedown",x=>{if(this.clicked)return!1;this.clicked=!0,this.infoPointIndex=x.target.userData.index,this.infoLabelElement.map(G=>{G.hide()}),v.show(),this.createInfoPointLabelLoop()}),c.addEventListener("mouseup",x=>{this.clicked=!1}),c.addEventListener("mouseover",x=>{document.body.style.cursor="pointer"}),c.addEventListener("mouseout",x=>{document.body.style.cursor="default"})});function l(r,o,d){let c=o.create("","info-point",!0);const[p,u]=t.geoProjection([r.lng,r.lat]);return c.init(` <div class='info-point-wrap'>
        <div class='info-point-wrap-inner'>
          <div class='info-point-line'>
            <div class='line'></div>
            <div class='line'></div>
            <div class='line'></div>
          </div>
          <div class='info-point-content'>
            <div class='content-item'><span class='label'>名称</span><span class='value'>${r.name}</span></div>
            <div class='content-item'><span class='label'>PM2.5</span><span class='value'>${r.value}ug/m²</span></div>
            <div class='content-item'><span class='label'>等级</span><span class='value'>${r.level}</span></div>
          </div>
        </div>
      </div>
    `,new g(p,-u,2.4)),o.setLabelStyle(c,.015,"x"),c.setParent(d),c.hide(),c}}createInfoPointLabelLoop(){clearInterval(this.infoPointLabelTime),this.infoPointLabelTime=setInterval(()=>{this.infoPointIndex++,this.infoPointIndex>=this.infoLabelElement.length&&(this.infoPointIndex=0),this.infoLabelElement.map((t,e)=>{this.infoPointIndex===e?t.show():t.hide()})},3e3)}geoProjection(t){return _().center(this.pointCenter).scale(120).translate([0,0])(t)}update(){super.update(),this.interactionManager&&this.interactionManager.update()}destroy(){super.destroy(),this.label3d&&this.label3d.destroy()}}const Ye={class:"map-gd"},Je=S("canvas",{id:"canvas"},null,-1),Ze={ref:"video1",class:"map-gd-video map-zj-video1",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},Ke=S("source",{src:ze},null,-1),et=[Ke],tt={ref:"video2",class:"map-gd-video map-zj-video2",width:"250",height:"100",loop:"",crossorigin:"anonymous",playsinline:"",style:{display:"none"}},at=S("source",{src:je},null,-1),it=[at],nt={class:"map-btn-group"},st=["onClick"],lt={__name:"map-animate",setup(P){let t=null;const e=Fe({flyLine:!1,particle:!1}),i=De();Ae();const a=[{type:"flyLine",label:"飞线",callback:()=>{e.flyLine=!e.flyLine,t.flyLineGroup.visible=e.flyLine,t.flyLineFocusGroup.visible=e.flyLine}},{type:"particle",label:"粒子特效",callback:()=>{e.particle=!e.particle,t.particles.enable=e.particle,t.particles.instance.visible=e.particle}}];return Re(()=>{t=new Qe(document.getElementById("canvas"),{geoProjectionCenter:[120.109913,29.181466],province:i.query.province||"浙江省"})}),qe(()=>{t&&t.destroy()}),(n,s)=>(U(),X("div",Ye,[Je,S("video",Ze,et,512),S("video",tt,it,512),S("div",nt,[(U(),X(ke,null,Ne(a,l=>S("div",{class:$e(["btn",{active:e[l.type]}]),onClick:l.callback},Ve(l.label),11,st)),64))])]))}};export{lt as default};
